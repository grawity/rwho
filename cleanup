#!/usr/bin/env php
<?php
namespace RWho;
require __DIR__."/lib-php/librwho.php";

function cleanup() {
	$max_age = intval(Config::get("cleanup.max-age",
			  Config::get("expire.host-dead")));

	$dbh = DB::connect();
	$rows = $dbh->exec("DELETE FROM utmp WHERE updated < ".(time()-$max_age));
	if ($rows === false) {
		$err = $dbh->errorInfo();
		fwrite(STDERR, "error: ".implode("; ", $err)."\n");
	}
	return $rows;
}

if (cleanup() === false)
	exit(1);
